<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="Dashboard.css">
</head>

<body>
    <nav id="nav-bar">
        <div class="welcome-msg">
            <span id="username"></span>
        </div>
        <div class="nav-items">
            <img class="user-profile" id="profilePic" src="user-profile.svg" alt="">
        </div>
        <div class="coin-info">
            <img class="coin-photos" src="coin.png" alt="">
            <span id="coinBank">0</span>
        </div>
    </nav>

    <section class="main">


        <div class="link-box">
            <div class="link-img">
                <a href="https://m.indiamart.com/impcat/ladies-jeans.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=0624&utm_content=5"
                    class="link" data-link-index="37"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2024/5/419435935/JM/JX/DO/195131304/ladies-wide-leg-jeans-1000x1000.png"
                        alt="link13"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://m.indiamart.com/impcat/arduino-board.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=0624&utm_content=12"
                    class="link" data-link-index="38"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2024/2/393455129/RD/OQ/PD/1225448/arduino-nano-board-r3-with-ch340-chip-without-usb-cable-compatible-with-arduino-soldered-1000x1000.jpg"
                        alt="link14"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://m.indiamart.com/impcat/ladies-printed-t-shirt.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=0624&utm_content=6"
                    class="link" data-link-index="39"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2022/12/DA/YX/DC/121323457/whatsapp-image-2022-11-09-at-3-53-14-pm-1--1000x1000.jpeg"
                        alt="link15"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://m.indiamart.com/impcat/bathroom-mirror.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=0624&utm_content=9"
                    class="link" data-link-index="40"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2023/2/QS/TZ/GQ/144743175/round-led-light-mirror-1000x1000.jpg"
                        alt="link16"></a>
            </div>
        </div>





        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/car-covers.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=82&utm_term=automobile,parts&spares"
                    class="link" data-link-index="33"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2023/8/337672347/GI/AG/KI/6093690/allextreme-vp7007-car-body-cover-compatible-with-volkswagen-polo-500x500.jpg"
                        alt="link13"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/motorcycle-cover.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=85&utm_term=automobile,parts&spares"
                    class="link" data-link-index="34"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2023/2/AP/WV/CC/18627269/motorcycle-cover-500x500.jpg"
                        alt="link14"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/body-massage-oil.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=91&utm_term=herbal&ayurvedicproduct"
                    class="link" data-link-index="35"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2023/2/UU/ZF/KY/1715402/body-massage-oil-250x250.jpg"
                        alt="link15"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/body-massager.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=88&utm_term=cosmetics&personalcare"
                    class="link" data-link-index="36"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2023/10/354294595/MK/KK/RH/117058690/ems-massage-stick-mini-neck-massager-500x500.jpg"
                        alt="link16"></a>
            </div>
        </div>



        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/car-wash-detergent.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=70&utm_term=housewares&supplies"
                    class="link" data-link-index="29"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2023/10/356164149/YT/XV/WT/837824/professional-liquid-laundry-detergent-250x250.jpg"
                        alt="link13"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/woodland-shoes.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=73&utm_term=fashionaccessories&gear"
                    class="link" data-link-index="30"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2023/7/329441213/ON/QP/GD/98305701/asics-safety-shoes-cp-201-500x500.jpg"
                        alt="link14"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/vega-helmets.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=76&utm_term=automobile,parts&spares"
                    class="link" data-link-index="31"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2022/2/PW/GO/QX/34684351/308-1000x1000.jpg"
                        alt="link15"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/prestige-induction-cooker.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=79&utm_term=consumerelectronics"
                    class="link" data-link-index="32"><img
                        src="https://5.imimg.com/data5/KG/XS/MY-8901635/prestige-induction-cooktop-1000x1000.jpg"
                        alt="link16"></a>
            </div>
        </div>




        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/floor-cleaner.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=55&utm_term=housewares&supplies"
                    class="link" data-link-index="25"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2024/4/410384397/BF/WE/RU/65327695/lizol-5l-disinfectant-surface-cleaner-250x250.jpg"
                        alt="link13"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/floor-wiper.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=58&utm_term=housewares&supplies"
                    class="link" data-link-index="26"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2024/3/402986526/MZ/IR/II/61292254/download-57-500x500.jpg"
                        alt="link14"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/v-guard-voltage-stabilizers.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=61&utm_term=electronicssupplies"
                    class="link" data-link-index="27"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2022/1/UD/CW/CH/2190471/mini-crystal-mini-crystal-v-guard-250x250.jpeg"
                        alt="link15"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/havells-ceiling-fans.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=64&utm_term=consumerelectronics"
                    class="link" data-link-index="28"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2022/10/DJ/LT/FK/46564151/ceiling-fan-500x500.jpeg"
                        alt="link16"></a>
            </div>
        </div>




        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/samsung-smart-tv.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=40&utm_term=consumerelectronics"
                    class="link" data-link-index="21"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2024/5/420484875/HA/MB/QA/152156605/whatsapp-image-2024-05-20-at-6-59-51-pm-2-250x250.jpeg"
                        alt="link13"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/hercules-bicycle.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=43&utm_term=bicycle,rickshaw&spares"
                    class="link" data-link-index="22"><img
                        src="https://4.imimg.com/data4/ON/PN/GLADMIN-185247/hercules-bicycle-250x250.jpg"
                        alt="link14"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/luminous-inverter-batteries.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=49&utm_term=electricalequipment"
                    class="link" data-link-index="23"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2022/9/PD/UO/ID/76088471/luminous-battery-1000x1000.jpg"
                        alt="link15"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/havells-tube-light.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=52&utm_term=consumerelectronics"
                    class="link" data-link-index="24"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2021/3/YX/YV/RR/12976638/havells-tube-light-500x500.jpg"
                        alt="link16"></a>
            </div>
        </div>


        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/allen-solly-shirt.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=31&utm_term=apparel&garments"
                    class="link" data-link-index="17"><img
                        src="https://5.imimg.com/data5/ANDROID/Default/2023/8/331591428/BE/OY/FE/146284842/product-jpeg-500x500.jpg"
                        alt="link13"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/mitsubishi-air-conditioner.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=34&utm_term=consumerelectronics"
                    class="link" data-link-index="18"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2022/11/IF/PS/MP/8012057/mitsubishi-electric-air-conditioning-250x250.jpg"
                        alt="link14"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/vip-luggage-bags.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_jun_24&utm_content=37&utm_term=bags,belts&wallets"
                    class="link" data-link-index="19"><img
                        src="https://5.imimg.com/data5/IOS/Default/2022/8/SI/TK/QZ/3741324/product-jpeg-500x500.png"
                        alt="link15"></a>
            </div>
        </div>
        <div class="link-box">
            <div class="link-img">
                <a href="https://dir.indiamart.com/impcat/solar-fans.html?utm_source=abmshorts&utm_medium=affiliate&utm_campaign=affiliate_pbp_may_24&utm_content=28&utm_term=electricalequipment"
                    class="link" data-link-index="20"><img
                        src="https://5.imimg.com/data5/SELLER/Default/2024/3/401709650/KT/QZ/TI/6093690/gigawatts-hyd-sf916a-20w-solar-powered-pedestal-fan-16-portable-and-quiet-with-high-power-air-250x250.jpg"
                        alt="link16"></a>
            </div>
        </div>


    </section>

    <script>
        const apiUrl = "https://backend-recent-2.onrender.com";

        document.addEventListener('DOMContentLoaded', async () => {
            const userId = new URLSearchParams(window.location.search).get('userId');
            if (!userId) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch(`${apiUrl}/profiles/${userId}`, {
                    method: 'GET',
                    credentials: 'include'
                });

                const data = await response.json();
                if (response.ok) {
                    document.getElementById('username').textContent = data.name;
                    document.getElementById('coinBank').textContent = data.coins;
                    document.getElementById('profilePic').addEventListener('click', () => {
                        window.location.href = `profile.html?userId=${data.userId}`;
                    });

                    const links = document.querySelectorAll('.link');
                    links.forEach((link) => {
                        const linkIndex = parseInt(link.dataset.linkIndex, 10);
                        const linkStatus = data.linkStatus[linkIndex];

                        if (linkStatus) {
                            link.classList.add('clicked');
                            link.style.pointerEvents = 'none';
                            link.querySelector('img').style.filter = 'blur(3px)';
                        }

                        link.addEventListener('click', async (event) => {
                            event.preventDefault();

                            const stayTime = 5000; // 5 seconds
                            const startTime = Date.now();

                            let timeoutId = setTimeout(() => {
                                alert("You did not stay at least 5 seconds on the clicked link page. You won't receive any coins.");
                                document.removeEventListener('visibilitychange', handleVisibilityChange);
                            }, stayTime);

                            const handleVisibilityChange = () => {
                                if (document.visibilityState === 'visible') {
                                    const elapsedTime = Date.now() - startTime;
                                    clearTimeout(timeoutId);
                                    if (elapsedTime >= stayTime) {
                                        updateCoinAndLinkState(linkIndex);
                                    } else {
                                        alert("You did not stay at least 5 seconds on the clicked link page. You won't receive any coins.");
                                    }
                                    document.removeEventListener('visibilitychange', handleVisibilityChange);
                                }
                            };

                            document.addEventListener('visibilitychange', handleVisibilityChange);
                            window.location.href = link.href; // Redirect to the clicked link
                        });
                    });
                } else {
                    console.error('Error:', data.message);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });

        async function updateCoinAndLinkState(index) {
            try {
                const userId = new URLSearchParams(window.location.search).get('userId');
                const updateResponse = await fetch(`${apiUrl}/update-link`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ userId, linkIndex: index })
                });

                if (updateResponse.ok) {
                    const updatedData = await updateResponse.json();
                    const coinBank = document.getElementById('coinBank');
                    coinBank.textContent = updatedData.user.coins;
                    coinBank.classList.add('coin-animate');
                    setTimeout(() => coinBank.classList.remove('coin-animate'), 1000);

                    const links = document.querySelectorAll('.link');
                    links.forEach((link) => {
                        const linkIndex = parseInt(link.dataset.linkIndex, 10);
                        if (linkIndex === index) {
                            link.classList.add('clicked');
                            link.style.pointerEvents = 'none';
                            link.querySelector('img').style.filter = 'blur(3px)';
                        }
                    });
                } else {
                    console.error('Failed to update link status');
                }
            } catch (error) {
                console.error('Error updating link status:', error);
            }
        }


    </script>
</body>

</html>